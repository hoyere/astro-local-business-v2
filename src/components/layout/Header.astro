---
import { siteConfig } from '../../site.config';
import ThemeToggle from '@components/common/ThemeToggle.astro';
import { Image } from 'astro:assets';
import logoLight from '@assets/images/brand/GA-logo-dev.png';
import logoDark from '@assets/images/brand/GA-logo-dev-darktheme.png';

const { navigation, name, contact } = siteConfig;
const currentPath = Astro.url.pathname;

/**
 * Logo display mode:
 * - 'logo-only': Just the logo image (name in alt text for a11y)
 * - 'logo-and-name': Logo + company name side by side (name hides on mobile)
 * - 'wordmark': Logo contains text, treated as single unit
 * - 'text-only': No logo, just styled text name
 */
type LogoMode = 'logo-only' | 'logo-and-name' | 'wordmark' | 'text-only';
const logoMode: LogoMode = 'logo-and-name';

// Whether logo images are available
const hasLogo = true;
---

<header class="site-header">
  <div class="header-container">
    <!-- Logo -->
    <a href="/" class="header-logo" aria-label={`${name} - Go to homepage`}>
      {/* Logo Image (if available and not text-only mode) */}
      {hasLogo && logoMode !== 'text-only' && (
        <span class="logo-image-wrapper">
          <Image
            src={logoLight}
            alt={logoMode === 'logo-only' ? name : ''}
            height={40}
            class="logo-image logo-light"
            loading="eager"
          />
          <Image
            src={logoDark}
            alt={logoMode === 'logo-only' ? name : ''}
            height={40}
            class="logo-image logo-dark"
            loading="eager"
          />
        </span>
      )}

      {/* Company Name Text */}
      {(logoMode === 'text-only' || logoMode === 'logo-and-name' || (!hasLogo && logoMode !== 'wordmark')) && (
        <span class:list={[
          'logo-text',
          { 'logo-text-with-image': hasLogo && logoMode === 'logo-and-name' }
        ]}>
          {name}
        </span>
      )}
    </a>

    <!-- Desktop Navigation -->
    <nav class="header-nav" aria-label="Main navigation">
      <ul class="nav-list">
        {navigation.map((link) => (
          <li>
            <a
              href={link.href}
              class:list={['nav-link', { active: currentPath === link.href }]}
            >
              {link.label}
            </a>
          </li>
        ))}
      </ul>
    </nav>

    <!-- Header Actions -->
    <div class="header-actions">
      <ThemeToggle />
      <a href={`tel:${contact.phone.replace(/[^0-9]/g, '')}`} class="btn btn-primary header-cta">
        {contact.phone}
      </a>
    </div>

    <!-- Mobile Menu Button -->
    <button
      class="mobile-menu-btn"
      aria-label="Toggle menu"
      aria-expanded="false"
      aria-controls="mobile-menu"
    >
      <span class="menu-icon"></span>
    </button>
  </div>

  <!-- Mobile Menu -->
  <div id="mobile-menu" class="mobile-menu" aria-hidden="true">
    <nav aria-label="Mobile navigation">
      <ul class="mobile-nav-list">
        {navigation.map((link) => (
          <li>
            <a
              href={link.href}
              class:list={['mobile-nav-link', { active: currentPath === link.href }]}
            >
              {link.label}
            </a>
          </li>
        ))}
      </ul>
      <a href={`tel:${contact.phone.replace(/[^0-9]/g, '')}`} class="btn btn-primary mobile-cta">
        Call {contact.phone}
      </a>
    </nav>
  </div>
</header>

<style>
  /* Logo Container */
  .header-logo {
    display: flex;
    align-items: center;
    gap: 0.75rem;
    text-decoration: none;
  }

  /* Logo Image Wrapper */
  .logo-image-wrapper {
    display: flex;
    flex-shrink: 0;
  }

  .logo-image {
    height: 40px;
    width: auto;
    display: block;
  }

  /* Theme-aware logo switching */
  .logo-light {
    display: block;
  }

  .logo-dark {
    display: none;
  }

  :global([data-theme="dark"]) .logo-light {
    display: none;
  }

  :global([data-theme="dark"]) .logo-dark {
    display: block;
  }

  /* Logo Text */
  .logo-text {
    font-size: 1.25rem;
    font-weight: 700;
    color: var(--color-text);
    white-space: nowrap;
  }

  /* Hide name on mobile when paired with logo */
  .logo-text-with-image {
    display: none;
  }

  @media (min-width: 640px) {
    .logo-text-with-image {
      display: block;
    }
  }

  /* Larger logo on bigger screens */
  @media (min-width: 768px) {
    .logo-image {
      height: 48px;
    }

    .logo-text {
      font-size: 1.5rem;
    }
  }

  /* Desktop Navigation */
  .nav-list {
    display: none;
    list-style: none;
    margin: 0;
    padding: 0;
    gap: 2rem;
  }

  @media (min-width: 768px) {
    .nav-list {
      display: flex;
    }
  }

  .nav-link {
    color: var(--color-text);
    font-weight: 500;
    padding: 0.5rem 0;
    position: relative;
  }

  .nav-link::after {
    content: '';
    position: absolute;
    bottom: 0;
    left: 0;
    width: 0;
    height: 2px;
    background-color: var(--color-primary);
    transition: width var(--transition-fast);
  }

  .nav-link:hover::after,
  .nav-link.active::after {
    width: 100%;
  }

  .nav-link.active {
    color: var(--color-primary);
  }

  /* Header Actions */
  .header-actions {
    display: flex;
    align-items: center;
    gap: 0.75rem;
  }

  .header-cta {
    display: none;
  }

  @media (min-width: 768px) {
    .header-cta {
      display: inline-flex;
    }
  }

  /* Mobile Menu Button */
  .mobile-menu-btn {
    display: flex;
    align-items: center;
    justify-content: center;
    width: 44px;
    height: 44px;
    background: none;
    border: none;
    cursor: pointer;
    padding: 0;
  }

  @media (min-width: 768px) {
    .mobile-menu-btn {
      display: none;
    }
  }

  .menu-icon {
    position: relative;
    width: 24px;
    height: 2px;
    background-color: var(--color-text);
    transition: background-color var(--transition-fast);
  }

  .menu-icon::before,
  .menu-icon::after {
    content: '';
    position: absolute;
    left: 0;
    width: 24px;
    height: 2px;
    background-color: var(--color-text);
    transition: transform var(--transition-fast);
  }

  .menu-icon::before {
    top: -8px;
  }

  .menu-icon::after {
    top: 8px;
  }

  .mobile-menu-btn[aria-expanded="true"] .menu-icon {
    background-color: transparent;
  }

  .mobile-menu-btn[aria-expanded="true"] .menu-icon::before {
    transform: rotate(45deg) translate(5px, 6px);
  }

  .mobile-menu-btn[aria-expanded="true"] .menu-icon::after {
    transform: rotate(-45deg) translate(5px, -6px);
  }

  /* Mobile Menu */
  .mobile-menu {
    position: absolute;
    top: var(--header-height);
    left: 0;
    right: 0;
    background-color: var(--color-background);
    border-bottom: 1px solid var(--color-border);
    padding: 1.5rem;
    display: none;
  }

  .mobile-menu[aria-hidden="false"] {
    display: block;
  }

  @media (min-width: 768px) {
    .mobile-menu {
      display: none !important;
    }
  }

  .mobile-nav-list {
    list-style: none;
    margin: 0 0 1.5rem;
    padding: 0;
  }

  .mobile-nav-link {
    display: block;
    padding: 0.75rem 0;
    color: var(--color-text);
    font-weight: 500;
    font-size: 1.125rem;
    border-bottom: 1px solid var(--color-border);
  }

  .mobile-nav-link.active {
    color: var(--color-primary);
  }

  .mobile-cta {
    width: 100%;
    text-align: center;
  }
</style>

<script>
  // Mobile menu toggle
  const menuBtn = document.querySelector('.mobile-menu-btn');
  const mobileMenu = document.getElementById('mobile-menu');

  if (menuBtn && mobileMenu) {
    menuBtn.addEventListener('click', () => {
      const isExpanded = menuBtn.getAttribute('aria-expanded') === 'true';
      menuBtn.setAttribute('aria-expanded', String(!isExpanded));
      mobileMenu.setAttribute('aria-hidden', String(isExpanded));
    });

    // Close menu when clicking a link
    mobileMenu.querySelectorAll('a').forEach(link => {
      link.addEventListener('click', () => {
        menuBtn.setAttribute('aria-expanded', 'false');
        mobileMenu.setAttribute('aria-hidden', 'true');
      });
    });
  }
</script>
