---
import { siteConfig } from '../../site.config';

const { navigation, name, contact } = siteConfig;
const currentPath = Astro.url.pathname;
---

<header class="site-header">
  <div class="header-container">
    <!-- Logo -->
    <a href="/" class="header-logo">
      <span class="logo-text">{name}</span>
    </a>

    <!-- Desktop Navigation -->
    <nav class="header-nav" aria-label="Main navigation">
      <ul class="nav-list">
        {navigation.map((link) => (
          <li>
            <a
              href={link.href}
              class:list={['nav-link', { active: currentPath === link.href }]}
            >
              {link.label}
            </a>
          </li>
        ))}
      </ul>
    </nav>

    <!-- CTA Button -->
    <div class="header-cta">
      <a href={`tel:${contact.phone.replace(/[^0-9]/g, '')}`} class="btn btn-primary">
        {contact.phone}
      </a>
    </div>

    <!-- Mobile Menu Button -->
    <button
      class="mobile-menu-btn"
      aria-label="Toggle menu"
      aria-expanded="false"
      aria-controls="mobile-menu"
    >
      <span class="menu-icon"></span>
    </button>
  </div>

  <!-- Mobile Menu -->
  <div id="mobile-menu" class="mobile-menu" aria-hidden="true">
    <nav aria-label="Mobile navigation">
      <ul class="mobile-nav-list">
        {navigation.map((link) => (
          <li>
            <a
              href={link.href}
              class:list={['mobile-nav-link', { active: currentPath === link.href }]}
            >
              {link.label}
            </a>
          </li>
        ))}
      </ul>
      <a href={`tel:${contact.phone.replace(/[^0-9]/g, '')}`} class="btn btn-primary mobile-cta">
        Call {contact.phone}
      </a>
    </nav>
  </div>
</header>

<style>
  /* Logo */
  .logo-text {
    font-size: 1.5rem;
    font-weight: 700;
    color: var(--color-text);
  }

  /* Desktop Navigation */
  .nav-list {
    display: none;
    list-style: none;
    margin: 0;
    padding: 0;
    gap: 2rem;
  }

  @media (min-width: 768px) {
    .nav-list {
      display: flex;
    }
  }

  .nav-link {
    color: var(--color-text);
    font-weight: 500;
    padding: 0.5rem 0;
    position: relative;
  }

  .nav-link::after {
    content: '';
    position: absolute;
    bottom: 0;
    left: 0;
    width: 0;
    height: 2px;
    background-color: var(--color-primary);
    transition: width var(--transition-fast);
  }

  .nav-link:hover::after,
  .nav-link.active::after {
    width: 100%;
  }

  .nav-link.active {
    color: var(--color-primary);
  }

  /* Header CTA */
  .header-cta {
    display: none;
  }

  @media (min-width: 768px) {
    .header-cta {
      display: block;
    }
  }

  /* Mobile Menu Button */
  .mobile-menu-btn {
    display: flex;
    align-items: center;
    justify-content: center;
    width: 44px;
    height: 44px;
    background: none;
    border: none;
    cursor: pointer;
    padding: 0;
  }

  @media (min-width: 768px) {
    .mobile-menu-btn {
      display: none;
    }
  }

  .menu-icon {
    position: relative;
    width: 24px;
    height: 2px;
    background-color: var(--color-text);
    transition: background-color var(--transition-fast);
  }

  .menu-icon::before,
  .menu-icon::after {
    content: '';
    position: absolute;
    left: 0;
    width: 24px;
    height: 2px;
    background-color: var(--color-text);
    transition: transform var(--transition-fast);
  }

  .menu-icon::before {
    top: -8px;
  }

  .menu-icon::after {
    top: 8px;
  }

  .mobile-menu-btn[aria-expanded="true"] .menu-icon {
    background-color: transparent;
  }

  .mobile-menu-btn[aria-expanded="true"] .menu-icon::before {
    transform: rotate(45deg) translate(5px, 6px);
  }

  .mobile-menu-btn[aria-expanded="true"] .menu-icon::after {
    transform: rotate(-45deg) translate(5px, -6px);
  }

  /* Mobile Menu */
  .mobile-menu {
    position: absolute;
    top: var(--header-height);
    left: 0;
    right: 0;
    background-color: var(--color-background);
    border-bottom: 1px solid var(--color-border);
    padding: 1.5rem;
    display: none;
  }

  .mobile-menu[aria-hidden="false"] {
    display: block;
  }

  @media (min-width: 768px) {
    .mobile-menu {
      display: none !important;
    }
  }

  .mobile-nav-list {
    list-style: none;
    margin: 0 0 1.5rem;
    padding: 0;
  }

  .mobile-nav-link {
    display: block;
    padding: 0.75rem 0;
    color: var(--color-text);
    font-weight: 500;
    font-size: 1.125rem;
    border-bottom: 1px solid var(--color-border);
  }

  .mobile-nav-link.active {
    color: var(--color-primary);
  }

  .mobile-cta {
    width: 100%;
    text-align: center;
  }
</style>

<script>
  // Mobile menu toggle
  const menuBtn = document.querySelector('.mobile-menu-btn');
  const mobileMenu = document.getElementById('mobile-menu');

  if (menuBtn && mobileMenu) {
    menuBtn.addEventListener('click', () => {
      const isExpanded = menuBtn.getAttribute('aria-expanded') === 'true';
      menuBtn.setAttribute('aria-expanded', String(!isExpanded));
      mobileMenu.setAttribute('aria-hidden', String(isExpanded));
    });

    // Close menu when clicking a link
    mobileMenu.querySelectorAll('a').forEach(link => {
      link.addEventListener('click', () => {
        menuBtn.setAttribute('aria-expanded', 'false');
        mobileMenu.setAttribute('aria-hidden', 'true');
      });
    });
  }
</script>
